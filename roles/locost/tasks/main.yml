---
# TODO: Install scc via: download release to /tmp, extract, copy to /usr/local/bin.
# Latest release: https://github.com/boyter/scc/releases/latest

- name: Create locost group
  group:
    name: locost
    system: true
  become: yes
  become_user: root

- name: Create locost user
  user:
    name: locost
    group: locost
    shell: /usr/sbin/nologin
    system: true
    create_home: false
  become: yes
  become_user: root

- name: Create locost systemd service
  template:
    src: locost.service.j2
    dest: /etc/systemd/system/locost.service
    mode: "0644"
    owner: root
    group: root
  notify: restart locost
  become: yes
  become_user: root

- name: Create locost systemd socket
  template:
    src: locost.socket.j2
    dest: /etc/systemd/system/locost.socket
    mode: "0644"
    owner: root
    group: root
  notify: restart locost
  become: yes
  become_user: root

- name: Start and enable locost.socket
  systemd:
    name: locost.socket
    state: started
    enabled: yes
    daemon_reload: yes
  become: yes
  become_user: root

- name: Start and enable locost.service
  systemd:
    name: locost.service
    state: started
    enabled: yes
    daemon_reload: yes
  become: yes
  become_user: root