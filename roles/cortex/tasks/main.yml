---

- name: Install Cortex
  apt:
    deb: https://github.com/cortexproject/cortex/releases/download/v{{ cortex_version }}/cortex-{{ cortex_version }}_amd64.deb
    update_cache: yes
  become: yes
  become_user: root

- name: Setup Cortex config file
  template:
    src: single-process-config.yaml.j2
    dest: /etc/cortex/single-process-config.yaml
    mode: "0640"
    owner: root
    group: cortex
  notify: restart cortex
  become: yes
  become_user: root

- name: Start and enable Cortex
  systemd:
    name: cortex
    state: started
    enabled: yes
    daemon_reload: yes
  become: yes
  become_user: root
